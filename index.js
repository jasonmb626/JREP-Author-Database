const fetch = require('node-fetch');
const fs = require('fs');

const submissions = [];
    
(async () => {
    for (let page = 1; page <= 44; page++) {
        const res = await fetch('https://www.editorialmanager.com/jrep/FG.ashx?fgdata=1&action=GetRecords', {
            method: 'POST',
            headers: {
                'Host': 'www.editorialmanager.com',
                'User-Agent': 'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:76.0) Gecko/20100101 Firefox/76.0',
                'Accept': '*/*',
                'Accept-Language': 'en-US,en;q=0.5',
                'Accept-Encoding': 'gzip, deflate, br',
                'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
                'X-Requested-With': 'XMLHttpRequest',
                'Content-Length': 9677,
                'Origin': 'https://www.editorialmanager.com',
                'Connection': 'keep-alive',
                'Referer': 'https://www.editorialmanager.com/jrep/SearchResults.aspx?hdnSearchID=&hdnLoadSavedSearch=False&exIS=off&exFD=off&MNFonly=off&exCS=off&SessionThreadIdField=97d09780-352d-4401-93c0-692461535c2c',
                'Cookie': 'EMSessionID=%7BA02B38B7%2D8A1A%2D4E79%2DA9C2%2D7DF9B30E6D79%7D; defaultMenu=0; CurrentLang=en-US',
            },
            body: `request=%7B%22ClientSettings%22%3A%7B%22GridSettings%22%3A%7B%22CPI%22%3A${page}%2C%22DSC%22%3A%7B%22SE%22%3A%22ManuscriptNumber%22%2C%22SD%22%3A0%7D%2C%22SC%22%3A%7B%22SE%22%3A%22ManuscriptNumber%22%2C%22SD%22%3A0%7D%2C%22DPS%22%3A10%2C%22PS%22%3A10%2C%22O%22%3A2%2C%22C%22%3A%5B%7B%22HT%22%3A%22Action%22%2C%22TT%22%3A%22Action%22%2C%22HV%22%3Anull%2C%22P%22%3Anull%2C%22F%22%3Afalse%2C%22FE%22%3Atrue%2C%22V%22%3Atrue%2C%22UV%22%3Atrue%2C%22UVE%22%3Atrue%2C%22CT%22%3Anull%2C%22UN%22%3A%22_AL_%22%2C%22R%22%3Atrue%2C%22HCSS%22%3A%22al-col%22%2C%22CCSS%22%3A%22al-cell%22%2C%22RN%22%3Atrue%2C%22S%22%3Afalse%2C%22W%22%3A180%2C%22UFL%22%3Afalse%2C%22OT%22%3Anull%7D%2C%7B%22HT%22%3A%22Manuscript+Number%22%2C%22TT%22%3A%22Click+to+reverse+sort+direction%22%2C%22HV%22%3Anull%2C%22P%22%3Anull%2C%22F%22%3Afalse%2C%22FE%22%3Atrue%2C%22V%22%3Atrue%2C%22UV%22%3Atrue%2C%22UVE%22%3Atrue%2C%22CT%22%3A1%2C%22UN%22%3A%22ManuscriptNumber%22%2C%22R%22%3Atrue%2C%22HCSS%22%3Anull%2C%22CCSS%22%3Anull%2C%22RN%22%3Atrue%2C%22S%22%3Atrue%2C%22W%22%3A100%2C%22UFL%22%3Afalse%2C%22OT%22%3Anull%7D%2C%7B%22HT%22%3A%22DOI%22%2C%22TT%22%3A%22Click+to+sort%22%2C%22HV%22%3Anull%2C%22P%22%3Anull%2C%22F%22%3Afalse%2C%22FE%22%3Atrue%2C%22V%22%3Atrue%2C%22UV%22%3Atrue%2C%22UVE%22%3Atrue%2C%22CT%22%3A17%2C%22UN%22%3A%22DOI%22%2C%22R%22%3Atrue%2C%22HCSS%22%3Anull%2C%22CCSS%22%3Anull%2C%22RN%22%3Atrue%2C%22S%22%3Atrue%2C%22W%22%3A90%2C%22UFL%22%3Afalse%2C%22OT%22%3Anull%7D%2C%7B%22HT%22%3A%22Author+Name%22%2C%22TT%22%3A%22Click+to+sort%22%2C%22HV%22%3Anull%2C%22P%22%3Anull%2C%22F%22%3Afalse%2C%22FE%22%3Atrue%2C%22V%22%3Atrue%2C%22UV%22%3Atrue%2C%22UVE%22%3Atrue%2C%22CT%22%3A5%2C%22UN%22%3A%22AuthorName%22%2C%22R%22%3Atrue%2C%22HCSS%22%3Anull%2C%22CCSS%22%3Anull%2C%22RN%22%3Atrue%2C%22S%22%3Atrue%2C%22W%22%3A90%2C%22UFL%22%3Afalse%2C%22OT%22%3Anull%7D%2C%7B%22HT%22%3A%22Article+Title%22%2C%22TT%22%3A%22Click+to+sort%22%2C%22HV%22%3Anull%2C%22P%22%3Anull%2C%22F%22%3Afalse%2C%22FE%22%3Atrue%2C%22V%22%3Atrue%2C%22UV%22%3Atrue%2C%22UVE%22%3Atrue%2C%22CT%22%3A4%2C%22UN%22%3A%22ArticleTitle%22%2C%22R%22%3Atrue%2C%22HCSS%22%3Anull%2C%22CCSS%22%3Anull%2C%22RN%22%3Atrue%2C%22S%22%3Atrue%2C%22W%22%3A90%2C%22UFL%22%3Afalse%2C%22OT%22%3Anull%7D%2C%7B%22HT%22%3A%22Article+Type%22%2C%22TT%22%3A%22Click+to+sort%22%2C%22HV%22%3Anull%2C%22P%22%3Anull%2C%22F%22%3Afalse%2C%22FE%22%3Atrue%2C%22V%22%3Atrue%2C%22UV%22%3Atrue%2C%22UVE%22%3Atrue%2C%22CT%22%3A2%2C%22UN%22%3A%22ArticleType%22%2C%22R%22%3Atrue%2C%22HCSS%22%3Anull%2C%22CCSS%22%3Anull%2C%22RN%22%3Atrue%2C%22S%22%3Atrue%2C%22W%22%3A75%2C%22UFL%22%3Afalse%2C%22OT%22%3Anull%7D%2C%7B%22HT%22%3A%22Short+Title%22%2C%22TT%22%3A%22Click+to+sort%22%2C%22HV%22%3Anull%2C%22P%22%3Anull%2C%22F%22%3Afalse%2C%22FE%22%3Atrue%2C%22V%22%3Atrue%2C%22UV%22%3Atrue%2C%22UVE%22%3Atrue%2C%22CT%22%3A19%2C%22UN%22%3A%22ShortTitle%22%2C%22R%22%3Atrue%2C%22HCSS%22%3Anull%2C%22CCSS%22%3Anull%2C%22RN%22%3Atrue%2C%22S%22%3Atrue%2C%22W%22%3A90%2C%22UFL%22%3Afalse%2C%22OT%22%3Anull%7D%2C%7B%22HT%22%3A%22Keywords%22%2C%22TT%22%3A%22Keywords%22%2C%22HV%22%3Anull%2C%22P%22%3Anull%2C%22F%22%3Afalse%2C%22FE%22%3Atrue%2C%22V%22%3Atrue%2C%22UV%22%3Atrue%2C%22UVE%22%3Atrue%2C%22CT%22%3A20%2C%22UN%22%3A%22Keywords%22%2C%22R%22%3Atrue%2C%22HCSS%22%3Anull%2C%22CCSS%22%3Anull%2C%22RN%22%3Atrue%2C%22S%22%3Afalse%2C%22W%22%3A90%2C%22UFL%22%3Afalse%2C%22OT%22%3Anull%7D%2C%7B%22HT%22%3A%22Classifications%22%2C%22TT%22%3A%22Classifications%22%2C%22HV%22%3Anull%2C%22P%22%3Anull%2C%22F%22%3Afalse%2C%22FE%22%3Atrue%2C%22V%22%3Atrue%2C%22UV%22%3Atrue%2C%22UVE%22%3Atrue%2C%22CT%22%3A21%2C%22UN%22%3A%22Classifications%22%2C%22R%22%3Atrue%2C%22HCSS%22%3Anull%2C%22CCSS%22%3Anull%2C%22RN%22%3Atrue%2C%22S%22%3Afalse%2C%22W%22%3A90%2C%22UFL%22%3Afalse%2C%22OT%22%3Anull%7D%2C%7B%22HT%22%3A%22Current+Status%22%2C%22TT%22%3A%22Click+to+sort%22%2C%22HV%22%3Anull%2C%22P%22%3Anull%2C%22F%22%3Afalse%2C%22FE%22%3Atrue%2C%22V%22%3Atrue%2C%22UV%22%3Atrue%2C%22UVE%22%3Atrue%2C%22CT%22%3A8%2C%22UN%22%3A%22CurrentStatus%22%2C%22R%22%3Atrue%2C%22HCSS%22%3Anull%2C%22CCSS%22%3Anull%2C%22RN%22%3Atrue%2C%22S%22%3Atrue%2C%22W%22%3A75%2C%22UFL%22%3Afalse%2C%22OT%22%3Anull%7D%2C%7B%22HT%22%3A%22Status+Date%22%2C%22TT%22%3A%22Click+to+sort%22%2C%22HV%22%3Anull%2C%22P%22%3Anull%2C%22F%22%3Afalse%2C%22FE%22%3Atrue%2C%22V%22%3Atrue%2C%22UV%22%3Atrue%2C%22UVE%22%3Atrue%2C%22CT%22%3A7%2C%22UN%22%3A%22StatusDate%22%2C%22R%22%3Atrue%2C%22HCSS%22%3Anull%2C%22CCSS%22%3Anull%2C%22RN%22%3Atrue%2C%22S%22%3Atrue%2C%22W%22%3A75%2C%22UFL%22%3Afalse%2C%22OT%22%3Anull%7D%2C%7B%22HT%22%3A%22Initial+Date+Submitted%22%2C%22TT%22%3A%22Click+to+sort%22%2C%22HV%22%3Anull%2C%22P%22%3Anull%2C%22F%22%3Afalse%2C%22FE%22%3Atrue%2C%22V%22%3Atrue%2C%22UV%22%3Atrue%2C%22UVE%22%3Atrue%2C%22CT%22%3A6%2C%22UN%22%3A%22InitialDateSubmitted%22%2C%22R%22%3Atrue%2C%22HCSS%22%3Anull%2C%22CCSS%22%3Anull%2C%22RN%22%3Atrue%2C%22S%22%3Atrue%2C%22W%22%3A100%2C%22UFL%22%3Afalse%2C%22OT%22%3Anull%7D%2C%7B%22HT%22%3A%22Reviewers%22%2C%22TT%22%3A%22Reviewers%22%2C%22HV%22%3Anull%2C%22P%22%3Anull%2C%22F%22%3Afalse%2C%22FE%22%3Atrue%2C%22V%22%3Atrue%2C%22UV%22%3Atrue%2C%22UVE%22%3Atrue%2C%22CT%22%3A27%2C%22UN%22%3A%22Reviewers%22%2C%22R%22%3Atrue%2C%22HCSS%22%3Anull%2C%22CCSS%22%3Anull%2C%22RN%22%3Atrue%2C%22S%22%3Afalse%2C%22W%22%3A90%2C%22UFL%22%3Afalse%2C%22OT%22%3Anull%7D%2C%7B%22HT%22%3A%22Review+Status%22%2C%22TT%22%3A%22Review+Status%22%2C%22HV%22%3Anull%2C%22P%22%3Anull%2C%22F%22%3Afalse%2C%22FE%22%3Atrue%2C%22V%22%3Atrue%2C%22UV%22%3Atrue%2C%22UVE%22%3Atrue%2C%22CT%22%3A10%2C%22UN%22%3A%22ReviewStatus%22%2C%22R%22%3Atrue%2C%22HCSS%22%3Anull%2C%22CCSS%22%3Anull%2C%22RN%22%3Atrue%2C%22S%22%3Afalse%2C%22W%22%3A200%2C%22UFL%22%3Afalse%2C%22OT%22%3Anull%7D%2C%7B%22HT%22%3A%22Handling+Editor%22%2C%22TT%22%3A%22Click+to+sort%22%2C%22HV%22%3Anull%2C%22P%22%3Anull%2C%22F%22%3Afalse%2C%22FE%22%3Atrue%2C%22V%22%3Atrue%2C%22UV%22%3Atrue%2C%22UVE%22%3Atrue%2C%22CT%22%3A9%2C%22UN%22%3A%22HandlingEditor%22%2C%22R%22%3Atrue%2C%22HCSS%22%3Anull%2C%22CCSS%22%3Anull%2C%22RN%22%3Atrue%2C%22S%22%3Atrue%2C%22W%22%3A90%2C%22UFL%22%3Afalse%2C%22OT%22%3Anull%7D%2C%7B%22HT%22%3A%22Assigned+Editors%22%2C%22TT%22%3A%22Assigned+Editors%22%2C%22HV%22%3Anull%2C%22P%22%3Anull%2C%22F%22%3Afalse%2C%22FE%22%3Atrue%2C%22V%22%3Atrue%2C%22UV%22%3Atrue%2C%22UVE%22%3Atrue%2C%22CT%22%3A28%2C%22UN%22%3A%22AssignedEditors%22%2C%22R%22%3Atrue%2C%22HCSS%22%3Anull%2C%22CCSS%22%3Anull%2C%22RN%22%3Atrue%2C%22S%22%3Afalse%2C%22W%22%3A90%2C%22UFL%22%3Afalse%2C%22OT%22%3Anull%7D%2C%7B%22HT%22%3A%22%22%2C%22TT%22%3Anull%2C%22HV%22%3Anull%2C%22P%22%3Anull%2C%22F%22%3Afalse%2C%22FE%22%3Afalse%2C%22V%22%3Afalse%2C%22UV%22%3Afalse%2C%22UVE%22%3Afalse%2C%22CT%22%3Anull%2C%22UN%22%3A%22_RC_%22%2C%22R%22%3Afalse%2C%22HCSS%22%3A%22colresize-col%22%2C%22CCSS%22%3A%22colresize-cell%22%2C%22RN%22%3Atrue%2C%22S%22%3Afalse%2C%22W%22%3A200%2C%22UFL%22%3Atrue%2C%22OT%22%3Anull%7D%5D%2C%22ALS%22%3A1%2C%22HS%22%3A1%7D%2C%22RequestSettings%22%3A%7B%22SessionId%22%3A%2297d09780-352d-4401-93c0-692461535c2c%22%2C%22InitialRequestOrigin%22%3A0%2C%22RowsPerChunkRequest%22%3A25%2C%22BatchSize%22%3A6%2C%22BatchInterval%22%3A2000%2C%22FailAttempts%22%3A0%7D%2C%22UserPreferenceSettings%22%3A%7B%22Enabled%22%3Atrue%2C%22PageName%22%3A%22SearchResults.asp%22%2C%22FolderName%22%3A%22%22%2C%22ViewKey%22%3A%22EditorialView%22%2C%22PreferenceSource%22%3A0%2C%22SavedSearchParameters%22%3Anull%7D%2C%22GridOptionSettings%22%3A%7B%22Show%22%3Atrue%2C%22Width%22%3A%22600px%22%7D%2C%22DimensionSettings%22%3Anull%2C%22UrlSettings%22%3A%7B%22Enabled%22%3Atrue%2C%22UpdateAtRowChange%22%3Afalse%2C%22KeysToUpdate%22%3A%5B%5D%2C%22Url%22%3A%22SearchResults.aspx%3FhdnSearchID%3D%26hdnLoadSavedSearch%3DFalse%26exIS%3Doff%26exFD%3Doff%26MNFonly%3Doff%26exCS%3Doff%26SessionThreadIdField%3D97d09780-352d-4401-93c0-692461535c2c%26CurrentPage%3D1%26CurrentRow%3D%22%2C%22EncodedUrl%22%3A%22SearchResults.aspx%253fhdnSearchID%253d%2526hdnLoadSavedSearch%253dFalse%2526exIS%253doff%2526exFD%253doff%2526MNFonly%253doff%2526exCS%253doff%2526SessionThreadIdField%253d97d09780-352d-4401-93c0-692461535c2c%22%7D%2C%22Parameters%22%3A%7B%22A%22%3Anull%2C%22B%22%3A0%2C%22C%22%3Afalse%2C%22CC%22%3Afalse%2C%22D%22%3Afalse%2C%22E%22%3Afalse%2C%22F%22%3Afalse%2C%22G%22%3Afalse%2C%22H%22%3Afalse%2C%22I%22%3Afalse%2C%22J%22%3Afalse%2C%22K%22%3Afalse%2C%22L%22%3Afalse%2C%22M%22%3Afalse%2C%22N%22%3A%2214cH9eUix6%2BWPvv0NwAeWNIGZmOL3yZFzGJKDtn%2FRdmpJQ9HdTNOCgzJKKM3actRux3tWRTp7QKmVA3gljoqkam3b5T%2BU2DP5YlxJb34JffbQTrb9BjJEBi1qJDljnG0HmND4X62kp7Ezy%2BbtNvCciQBMGgEc4otSGBEk78nwXlKD6oe3IsYcWGX2%2FGT1DVF0iY9ycm8P4eT6FqB22HNBw%3D%3D%22%2C%22O%22%3A%2297d09780-352d-4401-93c0-692461535c2c%22%2C%22P%22%3Anull%2C%22Q%22%3Afalse%2C%22R%22%3A%22%2Fjrep%2FSearchResults.aspx%3FhdnSearchID%3D%26hdnLoadSavedSearch%3DFalse%26exIS%3Doff%26exFD%3Doff%26MNFonly%3Doff%26exCS%3Doff%26SessionThreadIdField%3D97d09780-352d-4401-93c0-692461535c2c%22%2C%22S%22%3A%22%252fjrep%252fSearchResults.aspx%253fhdnSearchID%253d%2526hdnLoadSavedSearch%253dFalse%2526exIS%253doff%2526exFD%253doff%2526MNFonly%253doff%2526exCS%253doff%2526SessionThreadIdField%253d97d09780-352d-4401-93c0-692461535c2c%22%2C%22SS%22%3A%22SearchResults.aspx%3FhdnSearchID%3D%26hdnLoadSavedSearch%3DFalse%26exIS%3Doff%26exFD%3Doff%26MNFonly%3Doff%26exCS%3Doff%26SessionThreadIdField%3D97d09780-352d-4401-93c0-692461535c2c%22%2C%22T%22%3Atrue%2C%22U%22%3Atrue%2C%22V%22%3Anull%2C%22W%22%3Anull%2C%22X%22%3Anull%2C%22Y%22%3A47%2C%22Z%22%3Afalse%7D%2C%22HandlerPath%22%3A%22%2Fjrep%2FFG.ashx%3Ffgdata%3D1%26action%3D%22%2C%22Debug%22%3Afalse%7D%2C%22LookupCollection%22%3Anull%2C%22RequestId%22%3A0%2C%22RequestType%22%3A0%7D`
        });
        const data = await res.json();
        for (let i = 0; i < 10; i++) {
            console.log (`Page: ${page} entry: ${i}`);
            try {
                const objEntry = data.ActionLinkLookupCollection[`${i}`];
                submissions.push({
                    id: objEntry.ID,
                    paperTitle: objEntry.P1,
                    JREPNO: objEntry.A > 0 ? objEntry.D + 'R' + objEntry.A : objEntry.D,
                });
            } catch (e) {
                console.log(e);
            }
        }
    }
    console.log(submissions);
    fs.writeFileSync('./entries.json', JSON.stringify(submissions), 'utf-8');
});

const data = JSON.parse(fs.readFileSync('./entries.json'));
let str;
data.forEach(entry => {
    str = `${str}\nhttps://www.editorialmanager.com/jrep/EMDetails.aspx?docid=${entry.id}&ms_num=${entry.JREPNO}&sectionID=1`;
});
fs.writeFileSync('./urls.txt', str, 'utf-8');

